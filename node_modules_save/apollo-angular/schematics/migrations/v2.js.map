{"version":3,"file":"v2.js","sourceRoot":"","sources":["../../../schematics/migrations/v2.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  Rule,\n  Tree,\n  chain,\n  SchematicContext,\n  UpdateRecorder,\n} from '@angular-devkit/schematics';\nimport {NodePackageInstallTask} from '@angular-devkit/schematics/tasks';\nimport * as ts from 'typescript';\nimport {getJsonFile} from '../utils';\nimport {createDependenciesMap} from '../install/index';\n\nexport default function (): Rule {\n  return chain([migrateImports, migrateTsConfig, migrateDependencies]);\n}\n\nfunction migrateDependencies() {\n  return (tree: Tree, context: SchematicContext) => {\n    const packageJsonPath = 'package.json';\n    const packageJson = getJsonFile(tree, packageJsonPath);\n\n    packageJson.dependencies = packageJson.dependencies || {};\n\n    const dependenciesMap = createDependenciesMap({});\n\n    for (const dependency in dependenciesMap) {\n      if (dependenciesMap.hasOwnProperty(dependency)) {\n        const version = dependenciesMap[dependency];\n\n        packageJson.dependencies[dependency] = version;\n      }\n    }\n\n    const packagesToRemove = [\n      'graphql-tag',\n      'apollo-client',\n      'apollo-cache',\n      'apollo-cache-inmemory',\n      'apollo-utilities',\n      'apollo-link',\n      'apollo-link-http',\n      'apollo-link-batch-http',\n      'apollo-link-context',\n      'apollo-link-error',\n      'apollo-link-schema',\n      'apollo-link-ws',\n      'apollo-angular-link-http',\n      'apollo-angular-link-http-batch',\n      'apollo-angular-link-headers',\n    ];\n\n    const removedPackages: string[] = [];\n\n    packagesToRemove.forEach((packageName) => {\n      let removed = false;\n\n      if (packageJson.dependencies?.[packageName]) {\n        delete packageJson.dependencies[packageName];\n        removed = true;\n      }\n\n      if (packageJson.devDependencies?.[packageName]) {\n        delete packageJson.devDependencies[packageName];\n        removed = true;\n      }\n\n      if (removed) {\n        removedPackages.push(packageName);\n      }\n    });\n\n    removedPackages.forEach((packageName) => {\n      context.logger.info(`Removed ${packageName} dependency`);\n    });\n\n    // save the changed file\n    tree.overwrite(packageJsonPath, JSON.stringify(packageJson, null, 2));\n\n    // schedule `npm install`\n    context.addTask(new NodePackageInstallTask());\n\n    return tree;\n  };\n}\n\nexport async function migrateTsConfig(tree: Tree) {\n  const tsconfigPath = 'tsconfig.json';\n  const tsconfig = getJsonFile(tree, tsconfigPath);\n  const compilerOptions: ts.CompilerOptions = tsconfig.compilerOptions;\n\n  if (compilerOptions) {\n    compilerOptions.allowSyntheticDefaultImports = true;\n    tree.overwrite(tsconfigPath, JSON.stringify(tsconfig, null, 2));\n  } else {\n    const tsconfigBasePath = 'tsconfig.base.json';\n    const tsconfigBase = getJsonFile(tree, tsconfigBasePath);\n    const baseCompilerOptions: ts.CompilerOptions =\n      tsconfigBase.compilerOptions;\n\n    if (baseCompilerOptions) {\n      baseCompilerOptions.allowSyntheticDefaultImports = true;\n      tree.overwrite(tsconfigBasePath, JSON.stringify(tsconfigBase, null, 2));\n    }\n  }\n}\n\nfunction getIdentifiers(\n  namedBindings: ts.NamedImportBindings,\n  onIdentifier: (event: {name: string; alias?: string}) => void,\n) {\n  namedBindings.forEachChild((named) => {\n    if (ts.isImportSpecifier(named)) {\n      const name =\n        named.propertyName && typeof named.propertyName !== 'undefined'\n          ? named.propertyName.escapedText.toString()\n          : named.name.escapedText.toString();\n\n      onIdentifier({\n        name,\n        alias: name === named.name.escapedText.toString() ? undefined : name,\n      });\n    }\n  });\n}\n\nexport async function migrateImports(tree: Tree) {\n  tree.visit((path) => {\n    if (path.includes('node_modules') || !path.endsWith('.ts')) {\n      return;\n    }\n\n    const importsMap: Record<\n      string,\n      Array<{\n        name: string;\n        alias?: string;\n      }>\n    > = {};\n\n    function collectIdentifiers(\n      packageName: string,\n      namedBindings: ts.NamedImportBindings,\n    ) {\n      getIdentifiers(namedBindings, ({name, alias}) => {\n        if (!importsMap[packageName]) {\n          importsMap[packageName] = [];\n        }\n\n        importsMap[packageName].push({\n          name,\n          alias,\n        });\n      });\n    }\n\n    function redirectImport({\n      source,\n      target,\n      modulePath,\n      statement,\n      recorder,\n    }: {\n      source: string;\n      target: string;\n      modulePath: string;\n      statement: any;\n      recorder: UpdateRecorder;\n    }) {\n      if (modulePath === source) {\n        if (statement.importClause.namedBindings) {\n          collectIdentifiers(target, statement.importClause.namedBindings);\n        }\n\n        recorder.remove(statement.getStart(), statement.getWidth());\n      }\n    }\n\n    function redirectDefaultImport({\n      identifier,\n      source,\n      target,\n      modulePath,\n      statement,\n      recorder,\n    }: {\n      identifier: string;\n      source: string;\n      target: string;\n      modulePath: string;\n      statement: any;\n      recorder: UpdateRecorder;\n    }) {\n      if (modulePath === source && statement.importClause.name) {\n        if (!importsMap[target]) {\n          importsMap[target] = [];\n        }\n\n        const alias = statement.importClause.name.escapedText.toString();\n\n        importsMap[target].push({\n          name: identifier,\n          alias: alias !== identifier ? alias : undefined,\n        });\n\n        recorder.remove(statement.getStart(), statement.getWidth());\n      }\n    }\n\n    const sourceFile = ts.createSourceFile(\n      path,\n      tree.read(path).toString(),\n      ts.ScriptTarget.Latest,\n      true,\n    );\n\n    const recorder = tree.beginUpdate(path);\n\n    sourceFile.statements.forEach((statement) => {\n      if (\n        ts.isImportDeclaration(statement) &&\n        ts.isStringLiteral(statement.moduleSpecifier)\n      ) {\n        const nodeText = statement.moduleSpecifier.getText(sourceFile);\n        const modulePath = statement.moduleSpecifier\n          .getText(sourceFile)\n          .substr(1, nodeText.length - 2);\n\n        redirectImport({\n          source: 'apollo-cache-inmemory',\n          target: '@apollo/client/core',\n          recorder,\n          statement,\n          modulePath,\n        });\n\n        redirectImport({\n          source: 'apollo-client',\n          target: '@apollo/client/core',\n          recorder,\n          statement,\n          modulePath,\n        });\n\n        redirectImport({\n          source: 'apollo-link',\n          target: '@apollo/client/core',\n          recorder,\n          statement,\n          modulePath,\n        });\n\n        redirectImport({\n          source: 'apollo-cache',\n          target: '@apollo/client/core',\n          recorder,\n          statement,\n          modulePath,\n        });\n\n        redirectImport({\n          source: 'apollo-angular-link-http',\n          target: 'apollo-angular/http',\n          recorder,\n          statement,\n          modulePath,\n        });\n\n        redirectImport({\n          source: 'apollo-angular-link-http-batch',\n          target: 'apollo-angular/http',\n          recorder,\n          statement,\n          modulePath,\n        });\n\n        redirectImport({\n          source: 'apollo-utilities',\n          target: '@apollo/client/utilities',\n          recorder,\n          statement,\n          modulePath,\n        });\n\n        redirectImport({\n          source: 'apollo-link-http',\n          target: '@apollo/client/link/http',\n          recorder,\n          statement,\n          modulePath,\n        });\n\n        redirectImport({\n          source: 'apollo-link-batch-http',\n          target: '@apollo/client/link/batch-http',\n          recorder,\n          statement,\n          modulePath,\n        });\n\n        redirectImport({\n          source: 'apollo-link-context',\n          target: '@apollo/client/link/context',\n          recorder,\n          statement,\n          modulePath,\n        });\n\n        redirectImport({\n          source: 'apollo-link-error',\n          target: '@apollo/client/link/error',\n          recorder,\n          statement,\n          modulePath,\n        });\n\n        redirectImport({\n          source: 'apollo-link-schema',\n          target: '@apollo/client/link/schema',\n          recorder,\n          statement,\n          modulePath,\n        });\n\n        redirectImport({\n          source: 'apollo-link-ws',\n          target: '@apollo/client/link/ws',\n          recorder,\n          statement,\n          modulePath,\n        });\n\n        redirectImport({\n          source: 'apollo-angular',\n          target: 'apollo-angular',\n          recorder,\n          statement,\n          modulePath,\n        });\n\n        redirectImport({\n          source: 'apollo-angular-link-headers',\n          target: 'apollo-angular/headers',\n          recorder,\n          statement,\n          modulePath,\n        });\n\n        redirectDefaultImport({\n          identifier: 'ApolloClient',\n          source: 'apollo-client',\n          target: '@apollo/client/core',\n          recorder,\n          statement,\n          modulePath,\n        });\n\n        redirectDefaultImport({\n          identifier: 'gql',\n          source: 'graphql-tag',\n          target: 'apollo-angular',\n          recorder,\n          statement,\n          modulePath,\n        });\n      }\n    });\n\n    const importSources = Object.keys(importsMap);\n\n    importSources.forEach((importSource) => {\n      const props = importsMap[importSource]\n        .filter((im, i, all) => {\n          if (im.alias) {\n            return all.findIndex((f) => f.alias === im.alias) === i;\n          }\n\n          return all.findIndex((f) => f.name === im.name) === i;\n        })\n        .map((im) => (im.alias ? `${im.name} as ${im.alias}` : im.name))\n        .join(', ');\n      recorder.insertLeft(\n        sourceFile.getStart(),\n        `import {${props}} from '${importSource}';\\n`,\n      );\n    });\n\n    if (importSources.length) {\n      tree.commitUpdate(recorder);\n    }\n  });\n}\n"]}