const a8_0x2415=['value','startTask','Distributed\x20Execution\x20Terminated','../../../utilities/metric-logger','Main\x20job\x20was\x20terminated\x20via\x20SIGINT','push','apply','error:\x20','note','Status\x20update','./task-graph-creator','lifeCycle','find','logCommand','./node_modules/.cache/nx','cacheDirectory','../../../utilities/serializer-overrides','nodes','done','Processing\x20task\x20','executionStatus','/nx.json','taskId','getRunGroup','createStartRequest','encryptionKey','join','createTaskGraph','exit','serializeOverrides','throw','printRunGroupError','runUrl','../../error/print-run-group-error','Main\x20job\x20terminated\x20with\x20an\x20error:\x20\x22','nxCloudDistributedTasksRunner','readFileSync','VERBOSE_LOGGING','axiosException','SIGINT','completedTasks','../../file-storage/file-storage','defineProperty','configuration','error','strictlyOrderedTargets','target','NO_COMPLETED_TASKS_TIMEOUT','projectGraph','\x20seconds.','taskGraph','See\x20run\x20details\x20at\x20','number\x20of\x20completed\x20tasks:\x20','../../../utilities/environment','criticalErrorMessage','../../../utilities/create-unchanged-value-timeout','./split-task-graph-into-stages','FileStorage','reset','run','message','./distributed-execution.api','strip-json-comments','values','hash','success','TaskGraphCreator','Waiter','log','completeRunGroupWithError','then','Found\x20unknown\x20task:\x20','__awaiter','No\x20new\x20completed\x20tasks\x20after\x20','dependencies','Error:','status','length','scheduleTask','__esModule','project','../../api/error-reporter.api','wait','endTask','commandStatus','ErrorReporterApi','Retrieving\x20artifacts\x20from\x20','url','ENCRYPTION_KEY','build','SIGTERM','assign','Successfully\x20completed\x20running\x20the\x20command.'];(function(_0x2ce166,_0x2415d0){const _0x37ec53=function(_0x24b2a2){while(--_0x24b2a2){_0x2ce166['push'](_0x2ce166['shift']());}};_0x37ec53(++_0x2415d0);}(a8_0x2415,0x120));const a8_0x37ec=function(_0x2ce166,_0x2415d0){_0x2ce166=_0x2ce166-0x0;let _0x37ec53=a8_0x2415[_0x2ce166];return _0x37ec53;};'use strict';var __awaiter=this&&this[a8_0x37ec('0x3f')]||function(_0x19ef3f,_0x5494ad,_0x2a226c,_0x288150){function _0x16ec6e(_0x343664){return _0x343664 instanceof _0x2a226c?_0x343664:new _0x2a226c(function(_0x131fd5){_0x131fd5(_0x343664);});}return new(_0x2a226c||(_0x2a226c=Promise))(function(_0xe14f34,_0x1c3321){function _0x5694e8(_0x475665){try{_0x4edab9(_0x288150['next'](_0x475665));}catch(_0x1054e5){_0x1c3321(_0x1054e5);}}function _0x390e64(_0x1280fd){try{_0x4edab9(_0x288150[a8_0x37ec('0x15')](_0x1280fd));}catch(_0x28369f){_0x1c3321(_0x28369f);}}function _0x4edab9(_0x11309c){_0x11309c[a8_0x37ec('0x9')]?_0xe14f34(_0x11309c[a8_0x37ec('0x54')]):_0x16ec6e(_0x11309c[a8_0x37ec('0x54')])[a8_0x37ec('0x3d')](_0x5694e8,_0x390e64);}_0x4edab9((_0x288150=_0x288150[a8_0x37ec('0x5a')](_0x19ef3f,_0x5494ad||[]))['next']());});};Object[a8_0x37ec('0x21')](exports,a8_0x37ec('0x46'),{'value':!![]});exports[a8_0x37ec('0x1a')]=void 0x0;const fs_1=require('fs');const stripJsonComments=require(a8_0x37ec('0x35'));const create_unchanged_value_timeout_1=require(a8_0x37ec('0x2e'));const environment_1=require(a8_0x37ec('0x2c'));const metric_logger_1=require(a8_0x37ec('0x57'));const serializer_overrides_1=require(a8_0x37ec('0x7'));const waiter_1=require('../../../utilities/waiter');const error_reporter_api_1=require(a8_0x37ec('0x48'));const print_run_group_error_1=require(a8_0x37ec('0x18'));const e2e_encryption_1=require('../../file-storage/e2e-encryption');const file_storage_1=require(a8_0x37ec('0x20'));const distributed_execution_api_1=require(a8_0x37ec('0x34'));const split_task_graph_into_stages_1=require(a8_0x37ec('0x2f'));const task_graph_creator_1=require(a8_0x37ec('0x1'));const {output,workspaceRoot,getOutputs,Cache}=require('../../../utilities/nx-imports');class NoopLifeCycle{[a8_0x37ec('0x45')](_0x46d23a){}[a8_0x37ec('0x55')](_0x6b65ef){}[a8_0x37ec('0x4a')](_0x4125a2,_0x83856a){}}function runDistributedExecution(_0x2383ff,_0x32ddb2,_0x166cdb,_0x39af12,_0xf71582,_0x1a2e11,_0x36e7ae){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x86f182=yield _0x2383ff['start']((0x0,distributed_execution_api_1[a8_0x37ec('0xf')])(_0x1a2e11,(0x0,split_task_graph_into_stages_1['splitTasksIntoStages'])(_0x36e7ae),_0x32ddb2));return yield processTasks(_0x2383ff,_0x39af12,_0xf71582,_0x32ddb2,_0x86f182,Object[a8_0x37ec('0x36')](_0x36e7ae['tasks']),_0x166cdb);});}function processTasks(_0x3f52fa,_0x61d31c,_0x429c65,_0x3425e7,_0x28aec5,_0x5027cd,_0x240d4b){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x4aa1af={};const _0x20ec92=(0x0,create_unchanged_value_timeout_1['createUnchangedValueTimeout'])({'title':a8_0x37ec('0x40')+environment_1[a8_0x37ec('0x26')]/0x3e8+a8_0x37ec('0x28'),'timeout':environment_1[a8_0x37ec('0x26')]});const _0x3b4167=new waiter_1[(a8_0x37ec('0x3a'))]();while(!![]){if(environment_1[a8_0x37ec('0x1c')]){output['note']({'title':'Waiting...'});}yield _0x3b4167[a8_0x37ec('0x49')]();const _0x37263b=yield _0x3f52fa[a8_0x37ec('0x43')](_0x28aec5);if(environment_1[a8_0x37ec('0x1c')]){output[a8_0x37ec('0x5c')]({'title':a8_0x37ec('0x0'),'bodyLines':['executionId:\x20'+_0x28aec5,'executionStatus:\x20'+_0x37263b[a8_0x37ec('0xb')],a8_0x37ec('0x2b')+_0x37263b['completedTasks'][a8_0x37ec('0x44')],a8_0x37ec('0x5b')+_0x37263b[a8_0x37ec('0x2d')]]});}if(_0x37263b['criticalErrorMessage']){output[a8_0x37ec('0x23')]({'title':a8_0x37ec('0x56'),'bodyLines':[a8_0x37ec('0x42'),_0x37263b[a8_0x37ec('0x2d')]]});process[a8_0x37ec('0x13')](0x1);}_0x20ec92(_0x37263b[a8_0x37ec('0x1f')][a8_0x37ec('0x44')]);for(const _0x94b961 of _0x37263b['completedTasks']){if(_0x4aa1af[_0x94b961['taskId']])continue;yield processTask(_0x61d31c,_0x429c65,_0x240d4b,_0x3425e7,_0x5027cd,_0x94b961);_0x3b4167[a8_0x37ec('0x31')]();_0x4aa1af[_0x94b961[a8_0x37ec('0xd')]]=!![];}if(_0x37263b[a8_0x37ec('0xb')]==='COMPLETED'){return{'commandStatus':_0x37263b[a8_0x37ec('0x4b')],'runUrl':_0x37263b[a8_0x37ec('0x17')]};}}});}function processTask(_0x39cebf,_0x2cd871,_0x1afb5c,_0x259130,_0x41ada0,_0x5ab917){return __awaiter(this,void 0x0,void 0x0,function*(){if(environment_1[a8_0x37ec('0x1c')]){output[a8_0x37ec('0x5c')]({'title':a8_0x37ec('0xa')+_0x5ab917[a8_0x37ec('0xd')]});}const _0x10a520=_0x41ada0[a8_0x37ec('0x3')](_0x3a5306=>_0x5ab917[a8_0x37ec('0xd')]===_0x3a5306['id']);if(!_0x10a520){throw new Error(a8_0x37ec('0x3e')+_0x5ab917[a8_0x37ec('0xd')]);}if(environment_1[a8_0x37ec('0x1c')]){output['note']({'title':a8_0x37ec('0x4d')+_0x5ab917[a8_0x37ec('0x4e')]});}yield _0x39cebf['retrieve'](_0x5ab917['hash'],_0x5ab917[a8_0x37ec('0x4e')],_0x259130[a8_0x37ec('0x6')]||a8_0x37ec('0x5'));const _0x159810=yield _0x2cd871['get'](Object[a8_0x37ec('0x52')](Object['assign']({},_0x10a520),{'hash':_0x5ab917[a8_0x37ec('0x37')]}));const _0x3ddd53=getOutputs(_0x1afb5c[a8_0x37ec('0x27')][a8_0x37ec('0x8')],_0x10a520);if(environment_1[a8_0x37ec('0x1c')]){output[a8_0x37ec('0x5c')]({'title':'Extracting\x20artifacts','bodyLines':_0x3ddd53});}yield _0x2cd871['copyFilesFromCache'](_0x5ab917[a8_0x37ec('0x37')],_0x159810,_0x3ddd53);output[a8_0x37ec('0x4')](getCommand(_0x10a520));process['stdout']['write'](_0x159810['terminalOutput']);output['addVerticalSeparator']();});}function getCommand(_0x592d3b){const _0x21202e=_0x592d3b[a8_0x37ec('0x25')]['configuration']?':'+_0x592d3b[a8_0x37ec('0x25')][a8_0x37ec('0x22')]:'';return['nx',a8_0x37ec('0x32'),_0x592d3b[a8_0x37ec('0x25')][a8_0x37ec('0x47')]+':'+_0x592d3b['target'][a8_0x37ec('0x25')]+_0x21202e,(0x0,serializer_overrides_1[a8_0x37ec('0x14')])(_0x592d3b)][a8_0x37ec('0x11')]('\x20');}function attachSignalListenersToCompleteRunGroupOnError(_0x595e55,_0x562bcd){process['on'](a8_0x37ec('0x1e'),()=>__awaiter(this,void 0x0,void 0x0,function*(){yield _0x595e55[a8_0x37ec('0x3c')](_0x562bcd,a8_0x37ec('0x58'));process[a8_0x37ec('0x13')](0x1);}));process['on'](a8_0x37ec('0x51'),()=>__awaiter(this,void 0x0,void 0x0,function*(){yield _0x595e55[a8_0x37ec('0x3c')](_0x562bcd,'Main\x20job\x20was\x20terminated\x20via\x20SIGTERM');process[a8_0x37ec('0x13')](0x1);}));}const nxCloudDistributedTasksRunner=(_0x58a91b,_0x317ea8,_0xaeacdf)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){if(environment_1[a8_0x37ec('0x1c')]){output[a8_0x37ec('0x5c')]({'title':'Starting\x20distributed\x20command\x20execution'});}_0x317ea8[a8_0x37ec('0x2')]=new NoopLifeCycle();const _0x3e48e8=(0x0,environment_1[a8_0x37ec('0xe')])();if(!_0x3e48e8){(0x0,print_run_group_error_1[a8_0x37ec('0x16')])();return process[a8_0x37ec('0x13')](0x1);}const _0x39abc8=new e2e_encryption_1['E2EEncryption'](environment_1[a8_0x37ec('0x4f')]||_0x317ea8[a8_0x37ec('0x10')]);const _0x32578b=new error_reporter_api_1[(a8_0x37ec('0x4c'))](_0x317ea8);const _0x563bba=new file_storage_1[(a8_0x37ec('0x30'))](_0x39abc8,_0x32578b,!![],![]);const _0x4794c7=new Cache(_0x317ea8);const _0x257c02=new distributed_execution_api_1['DistributedExecutionApi'](_0x317ea8);attachSignalListenersToCompleteRunGroupOnError(_0x257c02,_0x3e48e8);try{const _0xe98a3f=getTaskGraph(_0xaeacdf,_0x58a91b,_0x317ea8);const _0x22f1ae=yield runDistributedExecution(_0x257c02,_0x317ea8,_0xaeacdf,_0x563bba,_0x4794c7,_0x3e48e8,_0xe98a3f);if(_0x22f1ae['commandStatus']===0x0){output[a8_0x37ec('0x38')]({'title':a8_0x37ec('0x53'),'bodyLines':[a8_0x37ec('0x2a')+_0x22f1ae[a8_0x37ec('0x17')]]});}else{output[a8_0x37ec('0x23')]({'title':'Command\x20execution\x20failed.','bodyLines':['See\x20run\x20details\x20at\x20'+_0x22f1ae[a8_0x37ec('0x17')]]});}yield(0x0,metric_logger_1['submitRunMetrics'])(_0x317ea8);process[a8_0x37ec('0x13')](_0x22f1ae['commandStatus']);}catch(_0x2fad86){output[a8_0x37ec('0x23')]({'title':'Unable\x20to\x20complete\x20a\x20run.','bodyLines':[_0x2fad86[a8_0x37ec('0x33')]]});if(_0x2fad86['axiosException']){console[a8_0x37ec('0x3b')](_0x2fad86[a8_0x37ec('0x1d')]);}else{console[a8_0x37ec('0x3b')](_0x2fad86);}try{yield _0x257c02[a8_0x37ec('0x3c')](_0x3e48e8,a8_0x37ec('0x19')+_0x2fad86[a8_0x37ec('0x33')]+'\x22');}finally{process['exit'](0x1);}}});exports['nxCloudDistributedTasksRunner']=nxCloudDistributedTasksRunner;function getTaskGraph(_0x5e6328,_0x1b4588,_0x544281){if(_0x5e6328['taskGraph']){return _0x5e6328[a8_0x37ec('0x29')];}else{const _0x52f019=JSON['parse'](stripJsonComments((0x0,fs_1[a8_0x37ec('0x1b')])(workspaceRoot+a8_0x37ec('0xc'))['toString']()));return new task_graph_creator_1[(a8_0x37ec('0x39'))](_0x5e6328[a8_0x37ec('0x27')],getDefaultDependencyConfigs(_0x52f019,_0x544281))[a8_0x37ec('0x12')](_0x1b4588);}}function getDefaultDependencyConfigs(_0x27dddf,_0x4fca24){var _0x5db225,_0x59258c;const _0x100f51=(_0x5db225=_0x27dddf['targetDependencies'])!==null&&_0x5db225!==void 0x0?_0x5db225:{};const _0x30a5e9=_0x4fca24?(_0x59258c=_0x4fca24[a8_0x37ec('0x24')])!==null&&_0x59258c!==void 0x0?_0x59258c:[a8_0x37ec('0x50')]:[];for(const _0x2639f9 of _0x30a5e9){_0x100f51[_0x2639f9]=_0x100f51[_0x2639f9]||[];_0x100f51[_0x2639f9][a8_0x37ec('0x59')]({'target':_0x2639f9,'projects':a8_0x37ec('0x41')});}return _0x100f51;}