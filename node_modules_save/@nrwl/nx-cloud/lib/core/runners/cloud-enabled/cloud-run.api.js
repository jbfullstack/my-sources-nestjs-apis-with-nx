const a3_0x4304=['response','startRun','post','stack','apiAxiosInstance','package.json','parse','data','createMetricRecorder','messages','value','urls','then','RUNNER_FAILURE_PERF_ENTRY','zlib','RunStart\x20duration','createApiAxiosInstance','length','createReqBody','getBranch','runUrl','defineProperty','RunStart','printDuration','throw','...','toString','@nrwl/nx-cloud','devDependencies','Invalid\x20end\x20run\x20response','Stack\x20Trace:','axiosException','Nx\x20Cloud:\x20Unknown\x20Error\x20Occurred','/nx-cloud/runs/start','RunEnd.\x20Completed\x20tasks','mapRespToPerfEntry','map','error','axiosMultipleTries','gzip','from','CloudRunApi','../../../utilities/environment','Run\x20Details:','__awaiter','VERBOSE_LOGGING','message','Invalid\x20Nx\x20Cloud\x20response:\x20','promisify','assign','endRun','__esModule','api','Invalid\x20end\x20run\x20response:\x20','nxCloudVersion','../../../utilities/axios','runContext','note','extractErrorMessage','../../../utilities/metric-logger','unknown','recordMetric','readFileSync','slice','machineInfo','success','apiError','headers','apply','next','application/octet-stream','status','stringify','RunEnd\x20duration'];(function(_0x4dc884,_0x43049c){const _0xe6f493=function(_0x3bf753){while(--_0x3bf753){_0x4dc884['push'](_0x4dc884['shift']());}};_0xe6f493(++_0x43049c);}(a3_0x4304,0x1ab));const a3_0xe6f4=function(_0x4dc884,_0x43049c){_0x4dc884=_0x4dc884-0x0;let _0xe6f493=a3_0x4304[_0x4dc884];return _0xe6f493;};'use strict';var __awaiter=this&&this[a3_0xe6f4('0x3d')]||function(_0x4391bf,_0x261ef2,_0x3d8c97,_0x3d9ade){function _0x423017(_0x422cd2){return _0x422cd2 instanceof _0x3d8c97?_0x422cd2:new _0x3d8c97(function(_0x3309a9){_0x3309a9(_0x422cd2);});}return new(_0x3d8c97||(_0x3d8c97=Promise))(function(_0x129a18,_0x41d0aa){function _0x4c0718(_0x4dcaba){try{_0x324999(_0x3d9ade[a3_0xe6f4('0xc')](_0x4dcaba));}catch(_0x349b5f){_0x41d0aa(_0x349b5f);}}function _0x153b2a(_0x227ec9){try{_0x324999(_0x3d9ade[a3_0xe6f4('0x29')](_0x227ec9));}catch(_0x20b0db){_0x41d0aa(_0x20b0db);}}function _0x324999(_0x4a9c34){_0x4a9c34['done']?_0x129a18(_0x4a9c34[a3_0xe6f4('0x1b')]):_0x423017(_0x4a9c34['value'])[a3_0xe6f4('0x1d')](_0x4c0718,_0x153b2a);}_0x324999((_0x3d9ade=_0x3d9ade[a3_0xe6f4('0xb')](_0x4391bf,_0x261ef2||[]))['next']());});};Object[a3_0xe6f4('0x26')](exports,a3_0xe6f4('0x44'),{'value':!![]});exports[a3_0xe6f4('0x3a')]=void 0x0;const axios_1=require(a3_0xe6f4('0x48'));const environment_1=require(a3_0xe6f4('0x3b'));const fs_1=require('fs');const zlib_1=require(a3_0xe6f4('0x1f'));const util_1=require('util');const metric_logger_1=require(a3_0xe6f4('0x2'));const {output}=require('../../../utilities/nx-imports');class CloudRunApi{constructor(_0x8887e7,_0x1ff789,_0x4f05cd,_0xc5cc14){this['messages']=_0x8887e7;this[a3_0xe6f4('0x49')]=_0x1ff789;this[a3_0xe6f4('0x7')]=_0xc5cc14;this[a3_0xe6f4('0x15')]=(0x0,axios_1[a3_0xe6f4('0x21')])(_0x4f05cd);}[a3_0xe6f4('0x12')](_0x497bb1,_0x12eaf9){var _0x8376e3;return __awaiter(this,void 0x0,void 0x0,function*(){const _0x28916f=(0x0,metric_logger_1[a3_0xe6f4('0x19')])(a3_0xe6f4('0x12'));try{const _0x295682={'meta':{'nxCloudVersion':this['nxCloudVersion']()},'branch':(0x0,environment_1[a3_0xe6f4('0x24')])(),'runGroup':(0x0,environment_1['getRunGroup'])(),'distributedExecutionId':_0x497bb1,'hashes':_0x12eaf9};if(environment_1[a3_0xe6f4('0x3e')]){output['note']({'title':a3_0xe6f4('0x27'),'bodyLines':['\x0a'+JSON[a3_0xe6f4('0xf')](_0x295682,null,0x2)]});}const _0x3e5607=yield(0x0,axios_1['printDuration'])(a3_0xe6f4('0x20'),()=>(0x0,axios_1['axiosMultipleTries'])(()=>this['apiAxiosInstance'][a3_0xe6f4('0x13')](a3_0xe6f4('0x32'),_0x295682)));_0x28916f[a3_0xe6f4('0x4')]((0x0,metric_logger_1[a3_0xe6f4('0x34')])(_0x3e5607));if(_0x3e5607['data']&&_0x3e5607[a3_0xe6f4('0x18')][a3_0xe6f4('0x3f')]){this[a3_0xe6f4('0x1a')][a3_0xe6f4('0x3f')]=_0x3e5607[a3_0xe6f4('0x18')][a3_0xe6f4('0x3f')];}if(!_0x3e5607[a3_0xe6f4('0x18')]||!_0x3e5607[a3_0xe6f4('0x18')][a3_0xe6f4('0x1c')]){this['messages'][a3_0xe6f4('0x9')]=a3_0xe6f4('0x40')+JSON[a3_0xe6f4('0xf')](_0x3e5607['data']);return{};}return _0x3e5607['data'][a3_0xe6f4('0x1c')];}catch(_0x30d617){_0x28916f['recordMetric'](((_0x8376e3=_0x30d617===null||_0x30d617===void 0x0?void 0x0:_0x30d617[a3_0xe6f4('0x30')])===null||_0x8376e3===void 0x0?void 0x0:_0x8376e3[a3_0xe6f4('0x11')])?(0x0,metric_logger_1['mapRespToPerfEntry'])(_0x30d617[a3_0xe6f4('0x30')]['response']):metric_logger_1[a3_0xe6f4('0x1e')]);this[a3_0xe6f4('0x1a')][a3_0xe6f4('0x9')]=this[a3_0xe6f4('0x1a')][a3_0xe6f4('0x1')](_0x30d617,a3_0xe6f4('0x45'));return{};}});}[a3_0xe6f4('0x23')](_0x977838,_0x49431b,_0x1bf0d8){const _0x57e9ab={'meta':{'nxCloudVersion':this[a3_0xe6f4('0x47')]()},'tasks':_0x49431b,'run':_0x977838,'linkId':_0x1bf0d8,'machineInfo':this[a3_0xe6f4('0x7')]};return JSON['stringify'](_0x57e9ab);}[a3_0xe6f4('0x43')](_0x4fefc3,_0x21226c,_0x4d7cd1){var _0x4cdde6,_0x11930c;return __awaiter(this,void 0x0,void 0x0,function*(){if(this[a3_0xe6f4('0x1a')][a3_0xe6f4('0x9')])return![];let _0x480c7d=this['createReqBody'](_0x4fefc3,_0x21226c,_0x4d7cd1);if(_0x480c7d[a3_0xe6f4('0x22')]>0x14*0x3e8*0x3e8){_0x480c7d=this[a3_0xe6f4('0x23')](_0x4fefc3,_0x21226c['map'](_0x4a5809=>Object[a3_0xe6f4('0x42')](Object['assign']({},_0x4a5809),{'hashDetails':undefined})));}const _0x2ac8fd=Buffer[a3_0xe6f4('0x39')](_0x480c7d);const _0x29200d=yield(0x0,util_1[a3_0xe6f4('0x41')])(zlib_1[a3_0xe6f4('0x38')])(_0x2ac8fd);const _0x1f8f5e=(0x0,metric_logger_1['createMetricRecorder'])('endRun');try{if(environment_1[a3_0xe6f4('0x3e')]){const _0x5b1527=_0x21226c[a3_0xe6f4('0x35')](_0x2b5a40=>{return Object[a3_0xe6f4('0x42')](Object['assign']({},_0x2b5a40),{'terminalOutput':_0x2b5a40['terminalOutput']?_0x2b5a40['terminalOutput'][a3_0xe6f4('0x6')](0x0,0x14)+a3_0xe6f4('0x2a'):undefined});});output[a3_0xe6f4('0x0')]({'title':a3_0xe6f4('0x33'),'bodyLines':['\x0a'+JSON[a3_0xe6f4('0xf')](_0x5b1527,null,0x2)]});}const _0xfc28b0=yield(0x0,axios_1[a3_0xe6f4('0x28')])(a3_0xe6f4('0x10'),()=>(0x0,axios_1[a3_0xe6f4('0x37')])(()=>this[a3_0xe6f4('0x15')][a3_0xe6f4('0x13')]('/nx-cloud/runs/end',_0x29200d,{'headers':Object[a3_0xe6f4('0x42')](Object[a3_0xe6f4('0x42')]({},this[a3_0xe6f4('0x15')]['defaults'][a3_0xe6f4('0xa')]),{'Content-Encoding':'gzip','Content-Type':a3_0xe6f4('0xd')})})));if(_0xfc28b0){_0x1f8f5e[a3_0xe6f4('0x4')]((0x0,metric_logger_1['mapRespToPerfEntry'])(_0xfc28b0));if(_0xfc28b0[a3_0xe6f4('0x18')]&&_0xfc28b0[a3_0xe6f4('0x18')][a3_0xe6f4('0x25')]&&_0xfc28b0[a3_0xe6f4('0x18')][a3_0xe6f4('0xe')]===a3_0xe6f4('0x8')){this[a3_0xe6f4('0x49')]['runUrl']=_0xfc28b0['data'][a3_0xe6f4('0x25')];return!![];}if(_0xfc28b0[a3_0xe6f4('0x18')]&&_0xfc28b0[a3_0xe6f4('0x18')][a3_0xe6f4('0xe')]){this[a3_0xe6f4('0x1a')][a3_0xe6f4('0x9')]='Invalid\x20end\x20run\x20response:\x20'+JSON[a3_0xe6f4('0xf')](_0xfc28b0[a3_0xe6f4('0x18')][a3_0xe6f4('0x3f')]);}else if(_0xfc28b0['data']&&typeof _0xfc28b0[a3_0xe6f4('0x18')]==='string'){if(_0xfc28b0[a3_0xe6f4('0x18')]!==a3_0xe6f4('0x8')){this['messages'][a3_0xe6f4('0x9')]=a3_0xe6f4('0x46')+JSON['stringify'](_0xfc28b0['data']);}}else{this[a3_0xe6f4('0x1a')][a3_0xe6f4('0x9')]=a3_0xe6f4('0x46')+JSON[a3_0xe6f4('0xf')](_0xfc28b0[a3_0xe6f4('0x18')]);}if(environment_1['VERBOSE_LOGGING']){output['note']({'title':a3_0xe6f4('0x2e'),'bodyLines':[JSON[a3_0xe6f4('0xf')](_0xfc28b0[a3_0xe6f4('0x18')],null,0x2)]});}}else{output[a3_0xe6f4('0x36')]({'title':a3_0xe6f4('0x31'),'bodyLines':['Run\x20completion\x20responded\x20with\x20`undefined`.',a3_0xe6f4('0x3c'),JSON['stringify'](_0x4fefc3,null,0x2),a3_0xe6f4('0x2f'),JSON[a3_0xe6f4('0xf')](new Error()[a3_0xe6f4('0x14')],null,0x2)]});}return![];}catch(_0x387de3){_0x1f8f5e[a3_0xe6f4('0x4')](((_0x4cdde6=_0x387de3===null||_0x387de3===void 0x0?void 0x0:_0x387de3[a3_0xe6f4('0x30')])===null||_0x4cdde6===void 0x0?void 0x0:_0x4cdde6[a3_0xe6f4('0x11')])?(0x0,metric_logger_1[a3_0xe6f4('0x34')])(_0x387de3[a3_0xe6f4('0x30')][a3_0xe6f4('0x11')]):metric_logger_1['RUNNER_FAILURE_PERF_ENTRY']);const _0x5ebc57=(_0x11930c=_0x387de3[a3_0xe6f4('0x30')])!==null&&_0x11930c!==void 0x0?_0x11930c:_0x387de3;this[a3_0xe6f4('0x1a')][a3_0xe6f4('0x9')]=this[a3_0xe6f4('0x1a')][a3_0xe6f4('0x1')](_0x5ebc57,a3_0xe6f4('0x45'));return![];}});}[a3_0xe6f4('0x47')](){try{const _0xa60c39=JSON[a3_0xe6f4('0x17')]((0x0,fs_1[a3_0xe6f4('0x5')])(a3_0xe6f4('0x16'))[a3_0xe6f4('0x2b')]());return _0xa60c39[a3_0xe6f4('0x2d')][a3_0xe6f4('0x2c')];}catch(_0x2884e6){return a3_0xe6f4('0x3');}}}exports['CloudRunApi']=CloudRunApi;