const a1_0x3b45=['__esModule','CloudEnabledLifeCycle','taskId','../../../utilities/nx-imports','lifeCycle','./node_modules/.cache/nx','CloudRunApi','env','pathExists','ACCESS_TOKEN','../../terminal-output/end-of-run-message','defineProperty','then','cacheableOperations','../../api/error-reporter.api','apply','skipNxCache','@nrwl/nx-cloud/lib/daemon/process-run-end','uploads','.nx.app','scan','requests','printMessages','throw','value','tasks-hashes-','stringify','getMachineInfo','FileStorage','endsWith','waitForStoreRequestsToComplete','error','localhost','./cloud-remote-cache','maskedProperties','./cloud-enabled-life-cycle','runUrl','assign','next','indexOf','join','all','NX_CLOUD_DISTRIBUTED_EXECUTION_ID','submitRunMetrics','enabled','cachePath','complete','Executed\x20tasks\x20with\x20hashes:\x20','generateUniqueLinkId','EndOfRunMessage','subscribe','message','../../../utilities/metric-logger','rxjs/internal/Subject','obfuscate','../../terminal-output/output-obfuscator','encryptionKey','ErrorReporterApi','MessageReporter','__awaiter','OutputObfuscator','./cloud-run.api','cacheDirectory','https://nx.app','VERBOSE_LOGGING','push','anyErrors','Nx\x20Cloud\x20wasn\x27t\x20able\x20to\x20store\x20artifacts.','toString','api.nrwl.io','fs-extra','../../file-storage/file-storage','daemon','../../file-storage/e2e-encryption','CloudRemoteCache','toISOString','Nx\x20Cloud\x20Problems','url','.commit','cloudEnabledTasksRunner','getBranch','printCacheHitsMessage','done','map','parseCommand','extractGitSha'];(function(_0x55aef5,_0x3b45ac){const _0x17aa86=function(_0x455f4b){while(--_0x455f4b){_0x55aef5['push'](_0x55aef5['shift']());}};_0x17aa86(++_0x3b45ac);}(a1_0x3b45,0x1cc));const a1_0x17aa=function(_0x55aef5,_0x3b45ac){_0x55aef5=_0x55aef5-0x0;let _0x17aa86=a1_0x3b45[_0x55aef5];return _0x17aa86;};'use strict';var __awaiter=this&&this[a1_0x17aa('0x1d')]||function(_0x4512b3,_0x31beb4,_0x2bad60,_0x3dfae2){function _0x53a145(_0x71fedd){return _0x71fedd instanceof _0x2bad60?_0x71fedd:new _0x2bad60(function(_0x458dd1){_0x458dd1(_0x71fedd);});}return new(_0x2bad60||(_0x2bad60=Promise))(function(_0x4b8e48,_0x18e4fc){function _0x340d0e(_0x2ee5fe){try{_0x2cf5c2(_0x3dfae2[a1_0x17aa('0x8')](_0x2ee5fe));}catch(_0x2ae99e){_0x18e4fc(_0x2ae99e);}}function _0x288bc1(_0x15fcdb){try{_0x2cf5c2(_0x3dfae2[a1_0x17aa('0x4f')](_0x15fcdb));}catch(_0x1c0f4e){_0x18e4fc(_0x1c0f4e);}}function _0x2cf5c2(_0x37dd72){_0x37dd72[a1_0x17aa('0x34')]?_0x4b8e48(_0x37dd72['value']):_0x53a145(_0x37dd72[a1_0x17aa('0x50')])[a1_0x17aa('0x44')](_0x340d0e,_0x288bc1);}_0x2cf5c2((_0x3dfae2=_0x3dfae2[a1_0x17aa('0x47')](_0x4512b3,_0x31beb4||[]))[a1_0x17aa('0x8')]());});};Object[a1_0x17aa('0x43')](exports,a1_0x17aa('0x38'),{'value':!![]});exports[a1_0x17aa('0x31')]=void 0x0;const message_reporter_1=require('../../terminal-output/message-reporter');const end_of_run_message_1=require(a1_0x17aa('0x42'));const output_obfuscator_1=require(a1_0x17aa('0x19'));const cloud_enabled_life_cycle_1=require(a1_0x17aa('0x5'));const file_storage_1=require(a1_0x17aa('0x29'));const e2e_encryption_1=require(a1_0x17aa('0x2b'));const environment_1=require('../../../utilities/environment');const cloud_remote_cache_1=require(a1_0x17aa('0x3'));const cloud_run_api_1=require(a1_0x17aa('0x1f'));const fs_1=require('fs');const path=require('path');const metric_logger_1=require(a1_0x17aa('0x16'));const error_reporter_api_1=require(a1_0x17aa('0x46'));const path_1=require('path');const fs_extra_1=require(a1_0x17aa('0x28'));const id_generator_1=require('./id-generator');const {tasksRunner,output,Cache}=require(a1_0x17aa('0x3b'));function createApi(_0x24470f,_0x32f535,_0x4bc29c){const _0x737d0=(0x0,environment_1[a1_0x17aa('0x53')])(_0x32f535);return new cloud_run_api_1[(a1_0x17aa('0x3e'))](_0x24470f,_0x4bc29c,_0x32f535,_0x737d0);}function storeTaskHashes(_0x25575e,_0x1c42c5,_0x505373){const _0x3a6c12=JSON[a1_0x17aa('0x52')](_0x25575e[a1_0x17aa('0x35')](_0xceeafb=>({'taskId':_0xceeafb[a1_0x17aa('0x3a')],'hash':_0xceeafb['hash']})));if(environment_1[a1_0x17aa('0x22')]){output['note']({'title':a1_0x17aa('0x11')+_0x3a6c12});}(0x0,fs_1['writeFileSync'])(path[a1_0x17aa('0xa')](_0x1c42c5,a1_0x17aa('0x51')+_0x505373),_0x3a6c12);}function onComplete({daemon,lifeCycle,options,remoteCache,api,outputObfuscator,runStartTime,messages,endOfRunMessage,taskExecutions,versionOfNxBefore133,inner,encryptionKey,fileStorage,uploadInCurrentProcess,runContext}){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x1bb485=new Date()[a1_0x17aa('0x2d')]();const _0x5b6005=(0x0,environment_1[a1_0x17aa('0x32')])();const _0x2a7da9={'command':outputObfuscator[a1_0x17aa('0x18')]((0x0,environment_1[a1_0x17aa('0x36')])()),'startTime':runStartTime,'endTime':_0x1bb485,'distributedExecutionId':environment_1[a1_0x17aa('0xc')],'branch':_0x5b6005,'scan':!![],'runGroup':(0x0,environment_1['getRunGroup'])(),'sha':_0x5b6005?(0x0,environment_1[a1_0x17aa('0x37')])():undefined,'inner':inner};if(uploadInCurrentProcess){if(environment_1['AGENT_RUNNING_IN_DISTRIBUTED_EXECUTION']){storeTaskHashes(taskExecutions,options[a1_0x17aa('0x20')]||a1_0x17aa('0x3d'),environment_1[a1_0x17aa('0xc')]);}try{yield remoteCache[a1_0x17aa('0x0')]();}catch(_0x1f47a7){output[a1_0x17aa('0x1')]({'title':a1_0x17aa('0x25')});messages[a1_0x17aa('0x4e')]();process['exit'](environment_1['DISTRIBUTED_TASK_EXECUTION_INTERNAL_ERROR_STATUS_CODE']);}try{yield api['endRun'](_0x2a7da9,taskExecutions);}catch(_0x8dda4e){output[a1_0x17aa('0x1')]({'title':'Nx\x20Cloud\x20wasn\x27t\x20able\x20to\x20record\x20its\x20run.'});messages[a1_0x17aa('0x4e')]();process['exit'](environment_1['DISTRIBUTED_TASK_EXECUTION_INTERNAL_ERROR_STATUS_CODE']);}yield(0x0,metric_logger_1[a1_0x17aa('0xd')])(options);}else{try{const _0x38fd71=environment_1[a1_0x17aa('0x41')]?environment_1['ACCESS_TOKEN']:options['accessToken'];const _0x195b79=(0x0,id_generator_1[a1_0x17aa('0x12')])();yield daemon['processInBackground'](a1_0x17aa('0x49'),{'encryptionKey':encryptionKey,'runnerOptions':Object[a1_0x17aa('0x7')](Object[a1_0x17aa('0x7')]({},options),{'accessToken':_0x38fd71}),'uploads':fileStorage[a1_0x17aa('0x4a')],'runEnd':{'runData':_0x2a7da9,'taskExecutions':taskExecutions,'linkId':_0x195b79}});runContext[a1_0x17aa('0x6')]=(options[a1_0x17aa('0x2f')]||a1_0x17aa('0x21'))+'/runs/'+_0x195b79;}catch(_0x16fac6){output['warn']({'title':a1_0x17aa('0x2e'),'bodyLines':[_0x16fac6[a1_0x17aa('0x15')]||_0x16fac6[a1_0x17aa('0x26')]()]});}}if(versionOfNxBefore133){setTimeout(()=>{messages['printMessages']();if(!messages['anyErrors']&&!inner){endOfRunMessage[a1_0x17aa('0x33')]();}},0x0);}else{messages[a1_0x17aa('0x4e')]();if(!messages[a1_0x17aa('0x24')]&&!inner){endOfRunMessage[a1_0x17aa('0x33')]();}}});}function createLifeCycle(_0x345939,_0x52b459,_0x282fae,_0x4e8927){const _0x150249=new cloud_enabled_life_cycle_1[(a1_0x17aa('0x39'))](_0x345939,_0x52b459[a1_0x17aa('0x20')],!!_0x52b459[a1_0x17aa('0x48')],_0x52b459[a1_0x17aa('0x4c')]===undefined?!![]:_0x52b459[a1_0x17aa('0x4c')],_0x52b459[a1_0x17aa('0x45')]||[],_0x282fae,_0x4e8927);try{const {CompositeLifeCycle}=require(a1_0x17aa('0x3b'));if(!CompositeLifeCycle)return _0x150249;return new CompositeLifeCycle([_0x52b459[a1_0x17aa('0x3c')],_0x150249]);}catch(_0x5b3f31){return _0x150249;}}function fetchUrlsForKnownHashesUpfront(_0x514e56,_0x10c73c,_0x29878b,_0x25cfee){return __awaiter(this,void 0x0,void 0x0,function*(){let _0x30fa2e=_0x29878b[a1_0x17aa('0x35')](_0x133393=>_0x133393['hash'])['filter'](_0x51fcce=>!!_0x51fcce);const _0x405baf=new Cache(_0x25cfee);if(!_0x25cfee[a1_0x17aa('0x48')]){const _0x385140=yield Promise[a1_0x17aa('0xb')](_0x30fa2e[a1_0x17aa('0x35')](_0x505bf7=>{const _0x29f272=(0x0,path_1[a1_0x17aa('0xa')])(_0x405baf[a1_0x17aa('0xf')],_0x505bf7+a1_0x17aa('0x30'));return(0x0,fs_extra_1[a1_0x17aa('0x40')])(_0x29f272);}));const _0x14a8e5=[];for(let _0x4e5b79=0x0;_0x4e5b79<_0x385140['length'];++_0x4e5b79){if(_0x385140[_0x4e5b79]){_0x14a8e5[a1_0x17aa('0x23')](_0x30fa2e[_0x4e5b79]);}}_0x30fa2e=_0x14a8e5;}if(_0x30fa2e['length']>0x0){const _0x113e06=_0x514e56['startRun'](environment_1['NX_CLOUD_DISTRIBUTED_EXECUTION_ID'],_0x30fa2e);for(const _0x1d28f0 of _0x30fa2e){_0x10c73c[a1_0x17aa('0x4d')][_0x1d28f0]=_0x113e06;}}});}function isConnectedToPrivateCloud(_0x48b6f2){if(!_0x48b6f2[a1_0x17aa('0x2f')])return![];if(_0x48b6f2[a1_0x17aa('0x2f')][a1_0x17aa('0x55')](a1_0x17aa('0x27')))return![];if(_0x48b6f2[a1_0x17aa('0x2f')]['endsWith'](a1_0x17aa('0x4b')))return![];if(_0x48b6f2['url'][a1_0x17aa('0x9')](a1_0x17aa('0x2'))>-0x1)return![];return!![];}function cloudEnabledTasksRunner(_0x44496b,_0x52156f,_0x5b3ea9,_0x17a583=![]){var _0x5ec162;const _0x48fc6f={'statuses':{},'scheduledTasks':[],'requests':{},'allTasks':_0x44496b};const _0xdd7645=_0x52156f[a1_0x17aa('0x3c')]===undefined;const _0x68185a=[];const _0x470f05=new message_reporter_1[(a1_0x17aa('0x1c'))](_0x52156f);const _0x38ce85=createApi(_0x470f05,_0x52156f,_0x48fc6f);const _0xca0099=new end_of_run_message_1[(a1_0x17aa('0x13'))](_0x48fc6f,_0x68185a);const _0x428f92=new output_obfuscator_1[(a1_0x17aa('0x1e'))](_0x52156f[a1_0x17aa('0x4')]);const _0x38cc62=new Date()[a1_0x17aa('0x2d')]();const _0x19bc3e=createLifeCycle(_0x48fc6f,_0x52156f,_0x428f92,_0x68185a);const _0x434d5b=environment_1['ENCRYPTION_KEY']||_0x52156f[a1_0x17aa('0x1a')];const _0x4473b0=new e2e_encryption_1['E2EEncryption'](_0x434d5b);const _0x336859=new error_reporter_api_1[(a1_0x17aa('0x1b'))](_0x52156f);const _0x1582dc=!!environment_1['AGENT_RUNNING_IN_DISTRIBUTED_EXECUTION']||!((_0x5ec162=_0x5b3ea9[a1_0x17aa('0x2a')])===null||_0x5ec162===void 0x0?void 0x0:_0x5ec162[a1_0x17aa('0xe')]())||isConnectedToPrivateCloud(_0x52156f);const _0x3d881=new file_storage_1[(a1_0x17aa('0x54'))](_0x4473b0,_0x336859,![],_0x1582dc);const _0x43932b=new cloud_remote_cache_1[(a1_0x17aa('0x2c'))](_0x470f05,_0x38ce85,_0x48fc6f,_0x3d881);fetchUrlsForKnownHashesUpfront(_0x38ce85,_0x48fc6f,_0x44496b,_0x52156f);delete process[a1_0x17aa('0x3f')][a1_0x17aa('0xc')];const _0x176b9b=tasksRunner(_0x44496b,Object[a1_0x17aa('0x7')](Object[a1_0x17aa('0x7')]({},_0x52156f),{'remoteCache':_0x43932b,'lifeCycle':_0x19bc3e}),_0x5b3ea9);if(_0x176b9b[a1_0x17aa('0x14')]){const {Subject}=require(a1_0x17aa('0x17'));const _0x258a3b=new Subject();_0x176b9b['subscribe']({'next':_0x188140=>_0x258a3b[a1_0x17aa('0x8')](_0x188140),'error':_0x2361b2=>_0x258a3b[a1_0x17aa('0x1')](_0x2361b2),'complete':()=>__awaiter(this,void 0x0,void 0x0,function*(){yield onComplete({'daemon':_0x5b3ea9[a1_0x17aa('0x2a')],'lifeCycle':_0x19bc3e,'options':_0x52156f,'remoteCache':_0x43932b,'api':_0x38ce85,'outputObfuscator':_0x428f92,'runStartTime':_0x38cc62,'messages':_0x470f05,'endOfRunMessage':_0xca0099,'taskExecutions':_0x68185a,'versionOfNxBefore133':_0xdd7645,'inner':_0x17a583,'encryptionKey':_0x434d5b,'fileStorage':_0x3d881,'uploadInCurrentProcess':_0x1582dc,'runContext':_0x48fc6f});_0x258a3b[a1_0x17aa('0x10')]();})});return _0x258a3b;}else{return _0x176b9b[a1_0x17aa('0x44')](_0x3aa2bc=>__awaiter(this,void 0x0,void 0x0,function*(){yield onComplete({'daemon':_0x5b3ea9[a1_0x17aa('0x2a')],'lifeCycle':_0x19bc3e,'options':_0x52156f,'remoteCache':_0x43932b,'api':_0x38ce85,'outputObfuscator':_0x428f92,'runStartTime':_0x38cc62,'messages':_0x470f05,'endOfRunMessage':_0xca0099,'taskExecutions':_0x68185a,'versionOfNxBefore133':_0xdd7645,'inner':_0x17a583,'encryptionKey':_0x434d5b,'fileStorage':_0x3d881,'uploadInCurrentProcess':_0x1582dc,'runContext':_0x48fc6f});return _0x3aa2bc;}))['catch'](_0x359435=>__awaiter(this,void 0x0,void 0x0,function*(){yield onComplete({'daemon':_0x5b3ea9[a1_0x17aa('0x2a')],'lifeCycle':_0x19bc3e,'options':_0x52156f,'remoteCache':_0x43932b,'api':_0x38ce85,'outputObfuscator':_0x428f92,'runStartTime':_0x38cc62,'messages':_0x470f05,'endOfRunMessage':_0xca0099,'taskExecutions':_0x68185a,'versionOfNxBefore133':_0xdd7645,'inner':_0x17a583,'encryptionKey':_0x434d5b,'fileStorage':_0x3d881,'uploadInCurrentProcess':_0x1582dc,'runContext':_0x48fc6f});throw _0x359435;}));}}exports[a1_0x17aa('0x31')]=cloudEnabledTasksRunner;